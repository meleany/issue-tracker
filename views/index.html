<!DOCTYPE html>
<html>
  <head>
    <title>Issue Tracker</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- import the webpage's stylesheet. The original code present on the boilerplate requires the ./public otherwise will not read it. -->
    <link rel="stylesheet" href="./public/style.css">

    <!-- import Google fonts and awesome icons -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css"/>
    <link href="https://fonts.googleapis.com/css?family=Orbitron:700" rel="stylesheet" type="text/css">
    <link href="https://fonts.googleapis.com/css?family=Julius Sans One" rel="stylesheet" type="text/css">
    <link href="https://fonts.googleapis.com/css?family=Electrolize" rel="stylesheet" type="text/css">        
    <link href="https://fonts.googleapis.com/css?family=Rajdhani:400,700" rel="stylesheet" type="text/css">           
  </head>
  
  <body>
    <header>
      <h1>Issue Tracker</h1>
      <h4>FreeCodeCamp Information Security & Quality Assurance Project 02</h4>
    </header>
    
    <div id="userstories">
      <h3>User Stories</h3>
      <ol>
        <li>Prevent cross-site scripting (XSS attack).</li>
        <li>I can <code>POST /api/issues/{projectname}</code> with form data containing required parameters <i>issue_title</i>, <i>issue_text</i>, 
            <i>created_by</i>, and optional <i>assigned_to</i> and <i>status_text</i>.
        </li>
        <li>The object saved and returned will include all of those fields (blank for optional no input) and also will include 
            <i>created_on</i> (date/time), <i>updated_on</i> (date/time), <i>open</i> (boolean, true for open, false for closed), and <i>_id</i>.
        </li>
        <li>I can <code>PUT /api/issues/{projectname}</code> with a <i>_id</i> and any fields in the object with a value to object. 
            Returned will be 'successfully updated' or 'could not update ' + <i>_id</i>. This should always update <i>updated_on</i>. If 
            no fields are sent return 'no updated field sent'.
        </li>
        <li>I can <code>DELETE /api/issues/{projectname}</code> with a <i>_id</i> to completely delete an issue. If no <i>_id</i> is sent return 
            '_id error'. Successfully deleted object returns the message: 'deleted '+<i>_id</i>, if failed then: 'could not delete '+<i>_id</i>.</li>
        <li>I can <code>GET /api/issues/{projectname}</code> for an array of all issues on that specific project with all the information 
            for each issue as was returned when posted.
        </li>
        <li>I can filter my get request by also passing along any field and value in the query. Example: <br>
            <code>GET /api/issues/{project}?open=false</code> <br>
            I can pass along as many fields/values as I want.
        </li>
        <li>All 11 functional tests are complete and passing.</li>
      </ol>
      
      <h3>Example usage</h3>
      <code>/api/issues/{project}</code><br>
      <code>/api/issues/{project}?open=true&amp;assigned_to=Joe</code><br><br>
      
      <h3>Example return</h3>
      <code>
        [{"_id":"5871dda29faedc3491ff93bb", "issue_title":"Fix error in posting data", "issue_text":"When we post data it has an error.",
        "created_on":"2017-01-08T06:35:14.240Z", "updated_on":"2017-01-08T06:35:14.240Z", "created_by":"Joe", "assigned_to":"Joe",
        open":true,"status_text":"In QA"}, ...]
      </code><br><br>
      
      <h3>Example:</h3>
      <a href="/apitest/" target="_blank">Go to <i>/apitest/</i> project issues</a>
    </div>
    
    <div id="testui">
      <h2>API Tests</h2>
      
      <form id="testForm" class="border">
        <fieldset>
          <legend>Submit issue on <b>apitest</b></legend>
          <input type="text" name="issue_title" placeholder="*Title" required><br>
          <textarea type="text" name="issue_text" placeholder="*Text" required></textarea><br>
          <input type="text" name="created_by" placeholder="*Created by" required><br>
          <input type="text" name="assigned_to" placeholder="Assigned to"><br>
          <input type="text" name="status_text" placeholder="Status text"><br>
          <button type="submit">Submit Issue</button>
        </fieldset>
      </form>
      
      <form id="testForm2" class="border">
        <fieldset>
          <legend>Update issue on <b>apitest</b> (Change any or all to update issue on the _id supplied)</legend>
          <input type="text" name="_id" placeholder="*_id" required><br>
          <input type="text" name="issue_title" placeholder="Title"><br>
          <textarea type="text" name="issue_text" placeholder="Text"></textarea><br>
          <input type="text" name="created_by" placeholder="Created by"><br>
          <input type="text" name="assigned_to" placeholder="Assigned to"><br>
          <input type="text" name="status_text" placeholder="Status text"><br>
          <label><input type="checkbox" name="open" value="false"> Check to close issue</label><br>
          <button type="submit">Submit Issue</button>          
        </fieldset>
      </form>
      
      <form id="testForm3" class="border">
        <fieldset>
          <legend>Delete issue on <b>apitest</b></legend>
          <input type="text" name="_id" placeholder="_id" required><br>
          <button type="submit">Delete Issue</button>
        </fieldset>
      </form>
      <pre><code id="jsonResult"></code></pre>
    </div>
    
    <footer>
      <div id="footer-row1">
        <a class="button" href="https://www.freecodecamp.com/meleany" target="_blank"> <i class="fa fa-free-code-camp fa-2x fa-fw"></i> </a> 
        <a class="button" href="https://github.com/meleany" target="_blank"> <i class="fa fa-github-alt fa-2x fa-fw"></i> </a>
        <a class="button" href="https://codepen.io/meleany" target="_blank"> <i class="fa fa-codepen fa-2x fa-fw"></i> </a>
        <a class="button" href="https://ymelbart.wordpress.com/" target="_blank"> <i class="fa fa-wordpress fa-2x fa-fw"></i> </a>
      </div>
      <div id="footer-row2">
        Designed by Yasmin Melean 2019.
      </div>
    </footer> 

    <!-- Your web-app is https, so your scripts need to be too -->
    <script src="https://code.jquery.com/jquery-2.2.1.min.js"
            integrity="sha256-gvQgAFzTH6trSrAWoH1iPo9Xc96QxSZ3feW6kem+O00="
            crossorigin="anonymous"></script>
    <script>
      $(function() {
        $('#testForm').submit(function(e) {
          $.ajax({
            url: '/api/issues/apitest',
            type: 'post',
            data: $('#testForm').serialize(),
            success: function(data) {
              $('#jsonResult').text(JSON.stringify(data));
            }
          });
          e.preventDefault();
        });
        $('#testForm2').submit(function(e) {
          $.ajax({
            url: '/api/issues/apitest',
            type: 'put',
            data: $('#testForm2').serialize(),
            success: function(data) {
              $('#jsonResult').text(JSON.stringify(data));
            }
          });
          e.preventDefault();
        });
        $('#testForm3').submit(function(e) {
          $.ajax({
            url: '/api/issues/apitest',
            type: 'delete',
            data: $('#testForm3').serialize(),
            success: function(data) {
              $('#jsonResult').text(JSON.stringify(data));
            }
          });
          e.preventDefault();
        });
      });
   </script>
  </body>
</html>